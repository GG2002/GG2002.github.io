---
title: è®¡ç®—æœºç½‘ç»œä¸²è®°
date: 2025-03-20 13:26:42
tags:
    - è®¡ç®—æœºç½‘ç»œ
    - ç¬”è®°
katex: true
---
# åè¯è§£é‡Š
## RDTï¼ˆReliable Data Transferï¼Œå¯é æ•°æ®ä¼ è¾“ï¼‰åè®®
é€šè¿‡ ARQ æŠ€æœ¯ä»¥å®žçŽ° RDT åè®®ï¼ŒTCP å°±æ˜¯ä¸€ç§ RDT åè®®ã€‚

## ARQï¼ˆAutomatic Repeat reQuestï¼Œè‡ªåŠ¨é‡ä¼ è¯·æ±‚ï¼‰
ARQ æ˜¯ä¸€ç§ç”¨äºŽæ•°æ®é€šä¿¡ä¸­çš„é”™è¯¯æŽ§åˆ¶æ–¹æ³•ï¼Œæ—¨åœ¨ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ã€‚ARQ åè®®é€šè¿‡åœ¨å‘é€ç«¯å’ŒæŽ¥æ”¶ç«¯ä¹‹é—´å¼•å…¥ç¡®è®¤æœºåˆ¶æ¥æ£€æµ‹å¹¶çº æ­£ä¼ è¾“è¿‡ç¨‹ä¸­å‡ºçŽ°çš„æ•°æ®ä¸¢å¤±æˆ–æŸåé—®é¢˜ã€‚
- **åœç­‰å¼ï¼ˆStop-and-Waitï¼‰ARQ**ï¼šæœ€ç®€å•çš„å½¢å¼ï¼Œæ¯å‘é€ä¸€ä¸ªæ•°æ®åŒ…åŽå°±åœæ­¢å¹¶ç­‰å¾…ç¡®è®¤ã€‚åªæœ‰åœ¨æ”¶åˆ° ACK ä¹‹åŽæ‰ä¼šå‘é€ä¸‹ä¸€ä¸ªæ•°æ®åŒ…ã€‚è¿™ç§æ–¹æ³•æ•ˆçŽ‡è¾ƒä½Žï¼Œå› ä¸ºå‘é€æ–¹åœ¨ç­‰å¾…ç¡®è®¤æ—¶å¤„äºŽç©ºé—²çŠ¶æ€ã€‚  
- **å›žé€€ N æ­¥ï¼ˆGo-Back-Nï¼ŒGBNï¼‰ARQ**ï¼šå…è®¸å‘é€æ–¹è¿žç»­å‘é€å¤šä¸ªæ•°æ®åŒ…è€Œä¸éœ€è¦ç«‹å³ç­‰å¾…æ¯ä¸ªæ•°æ®åŒ…çš„ç¡®è®¤ã€‚å¦‚æžœæŸä¸ªæ•°æ®åŒ…æœªè¢«æ­£ç¡®æŽ¥æ”¶ï¼Œå‘é€æ–¹éœ€è¦é‡ä¼ ä»Žé‚£ä¸ªæ•°æ®åŒ…å¼€å§‹åˆ°å½“å‰çš„æ‰€æœ‰åŽç»­æ•°æ®åŒ…ã€‚
- **é€‰æ‹©æ€§é‡ä¼ ï¼ˆSelective Repeatï¼ŒSRï¼‰ARQ**ï¼šç±»ä¼¼äºŽå›žé€€ N æ­¥ ARQï¼Œä½†æ›´é«˜æ•ˆã€‚å®ƒåªéœ€è¦é‡ä¼ é‚£äº›ç¡®å®žä¸¢å¤±æˆ–æŸåçš„æ•°æ®åŒ…ï¼Œè€Œä¸æ˜¯ä»Žå‡ºé”™ç‚¹å¼€å§‹çš„æ‰€æœ‰åŽç»­æ•°æ®åŒ…ã€‚è¿™å‡å°‘äº†ä¸å¿…è¦çš„é‡ä¼ ï¼Œæé«˜äº†æ•ˆçŽ‡ã€‚

## MTUï¼ˆMaximum Transmission Unitï¼Œæ•°æ®é“¾è·¯å±‚å¸§å¤§å°ï¼‰
**MTU æ˜¯é“¾è·¯å±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ / Layer 2ï¼‰çš„æœ€å¤§ä¼ è¾“å•å…ƒå¤§å°**ï¼Œè¡¨ç¤ºä¸€ä¸ªå¸§å¯ä»¥æ‰¿è½½çš„æœ€å¤§æ•°æ®é‡ï¼ˆä¸åŒ…æ‹¬é“¾è·¯å±‚å¤´éƒ¨å’Œå°¾éƒ¨æ ¡éªŒï¼‰ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼ˆByteï¼‰ã€‚
> ðŸ’¡ **æ³¨æ„ï¼šMTU çš„å€¼æŒ‡çš„æ˜¯ IP å±‚åŠå…¶ä»¥ä¸Šï¼ˆTCPã€UDP ç­‰ï¼‰çš„æ•°æ®æ€»é•¿åº¦ä¸Šé™ã€‚**

### ðŸ“Œ å¸¸è§ MTU å€¼ï¼š
| ç½‘ç»œç±»åž‹           | é»˜è®¤ MTUï¼ˆå­—èŠ‚ï¼‰           |
| ------------------ | -------------------------- |
| ä»¥å¤ªç½‘ï¼ˆEthernetï¼‰ | 1500                       |
| PPPoE              | 1492                       |
| WLANï¼ˆWi-Fiï¼‰      | é€šå¸¸ä¹Ÿæ˜¯ 1500              |
| éš§é“æŽ¥å£           | å¯èƒ½æ›´å°ï¼ˆå¦‚ 1400 æˆ–æ›´ä½Žï¼‰ |

## MSSï¼ˆMaximum Segment Sizeï¼ŒTCP åˆ†æ®µçš„å‚æ•°ï¼‰
**MSS æ˜¯ TCP å±‚çš„ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå•ä¸ª TCP æ®µä¸­å¯ä»¥æ‰¿è½½çš„æœ€å¤§åº”ç”¨å±‚æ•°æ®é‡ï¼ˆä¸å« TCP å’Œ IP å¤´éƒ¨ï¼‰**ã€‚
> â— MSS = MTU - IP å¤´éƒ¨ - TCP å¤´éƒ¨

é€šå¸¸æ ‡å‡†å¤´éƒ¨æ˜¯ï¼š
- IPv4 å¤´éƒ¨ï¼š20 å­—èŠ‚
- TCP å¤´éƒ¨ï¼š20 å­—èŠ‚  
=> æ‰€ä»¥ MSS = 1500 - 20 - 20 = **1460 å­—èŠ‚**

å¯¹äºŽ TCP æ¥è¯´ï¼Œå®ƒæ˜¯å°½é‡é¿å…åˆ†ç‰‡çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå¦‚æžœåœ¨ IP å±‚è¿›è¡Œåˆ†ç‰‡çš„è¯ï¼Œå…¶ä¸­çš„æŸç‰‡æ•°æ®ä¹Ÿè®¸ä¼šä¸¢å¤±ï¼Œè¿™ä¼šå¢žå¤§ TCP åè®®é‡ä¼ æ•°æ®åŒ…åˆ†ç»„çš„æœºçŽ‡ï¼ŒçœŸè¦é‡ä¼ çš„æ—¶å€™è¿˜å¿…é¡»é‡ä¼ æ•´ä¸ª TCP åˆ†ç»„ï¼ˆè¿›è¡Œ IP åˆ†ç‰‡å‰çš„æ•°æ®åŒ…ï¼‰ã€‚

å› æ­¤ TCP/IP åè®®ä¼šè‡ªåŠ¨æŽ¢æµ‹ä»Žæºåˆ°ç›®çš„è·¯å¾„ä¸Šæœ€å°çš„ MTUï¼Œå¹¶æ®æ­¤è°ƒæ•´å‘é€çš„ MSSï¼Œé˜²æ­¢ IP åˆ†ç‰‡ã€‚

ä½†æ˜¯å¯¹äºŽ UDP åè®®è€Œè¨€ï¼Œè¿™ä¸ªåè®®æœ¬èº«æ˜¯æ— è¿žæŽ¥çš„åè®®ï¼Œå¯¹æ•°æ®åŒ…çš„åˆ°è¾¾é¡ºåºä»¥åŠæ˜¯å¦æ­£ç¡®åˆ°è¾¾å¹¶ä¸å…³å¿ƒï¼Œæ‰€ä»¥ä¸€èˆ¬ UDP åº”ç”¨å¯¹åˆ†ç‰‡æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ã€‚

### ðŸ“Œ MSS ä¸¾ä¾‹ï¼š
| åè®®ç»„åˆ     | MTU  | IP å¤´ | TCP å¤´ | MSS  |
| ------------ | ---- | ----- | ------ | ---- |
| IPv4 + TCP   | 1500 | 20    | 20     | 1460 |
| IPv6 + TCP   | 1500 | 40    | 20     | 1440 |
| PPPoE + IPv4 | 1492 | 20    | 20     | 1452 |

## MTU å’Œ MSS çš„å…³ç³»å›¾è§£
```
+------------------------------------------+
|               Ethernet Frame             |
+------------+----------+------------------+
| MACå¤´(14B) | ç±»åž‹(2B) | Data (1500B, MTU) |
+------------+----------+------------------+
                                â†“
                        +----------------+-----------------+-----------------------+
                        | IP Header (20B)| TCP Header (20B)| Data (max 1460Bï¼ŒMSS) |
                        +----------------+-----------------+-----------------------+
```

## TCP åŠè¿žæŽ¥é˜Ÿåˆ—ä¸Žå…¨è¿žæŽ¥é˜Ÿåˆ—
ä»Žä¸‰æ¬¡æ¡æ‰‹æµç¨‹å¯çŸ¥ï¼Œå®¢æˆ·ç«¯ä¼šå‘æœåŠ¡ç«¯å‘ä¸¤æ¬¡è¯·æ±‚ï¼š
1. ç¬¬ä¸€æ¬¡è¯·æ±‚å°±ä¼šæ”¾åœ¨ TCP åŠè¿žæŽ¥é˜Ÿåˆ—
2. ç¬¬äºŒæ¬¡è¯·æ±‚å°±ä¼šå°†è¯·æ±‚ä»ŽåŠè¿žæŽ¥é˜Ÿåˆ—é‡Œæ‹¿å‡ºæ”¾åˆ°å…¨è¿žæŽ¥é˜Ÿåˆ—é‡Œã€‚

SYN æ´ªæ³›æ”»å‡»å°±æ˜¯æ”»å‡»åŠè¿žæŽ¥é˜Ÿåˆ—å¯¼è‡´å…¶æº¢å‡ºï¼ŒåŽç»­çš„æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚éƒ½å°†è¢«ç›´æŽ¥æŠ›å¼ƒã€‚

# TCP
TCP åŒ…ç»“æž„å¦‚ä¸‹ï¼š
![TCP åŒ…ç»“æž„](https://gg2002.github.io/img/interview-computer-network/TCPåŒ…ç»“æž„.png)

## ä¸‰æ¬¡æ¡æ‰‹ä¸Žå››æ¬¡æŒ¥æ‰‹
TCP ä¸‰æ¬¡æ¡æ‰‹ä¸Žå››æ¬¡æŒ¥æ‰‹å‡å¯è§†ä½œä»¥ä¸‹ä¸¤ä¸ªè¡Œä¸ºçš„æ‹¼æŽ¥ï¼š
- å®¢æˆ·ç«¯ä¸ç¡®å®šæœåŠ¡ç«¯çŠ¶æ€ï¼Œå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚å¹¶ç­‰å¾…å›žåº”ï¼ŒæœåŠ¡ç«¯å›žåº”
- æœåŠ¡ç«¯ä¸ç¡®å®šå®¢æˆ·ç«¯çŠ¶æ€ï¼Œå‘å®¢æˆ·ç«¯å‘é€è¯·æ±‚å¹¶ç­‰å¾…å›žåº”ï¼Œå®¢æˆ·ç«¯å›žåº”

### ä¸‰æ¬¡æ¡æ‰‹
![TCP ä¸‰æ¬¡æ¡æ‰‹](https://gg2002.github.io/img/interview-computer-network/TCPä¸‰æ¬¡æ¡æ‰‹.png)
- ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯é¦–å…ˆå‘èµ·è¯·æ±‚ï¼ŒæœŸæœ›å¾—åˆ°æœåŠ¡ç«¯çš„å›žåº”
- ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯ä¸ä»…å›žåº”å®¢æˆ·ç«¯è¿˜æƒ³ç¡®å®šå®¢æˆ·ç«¯çŠ¶æ€ï¼Œå› æ­¤å°†ä¸¤æ¬¡è¯·æ±‚åˆä¸ºä¸€æ¬¡
- ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯å›žåº”æœåŠ¡ç«¯

æŒ‰ä¸Šè¿°é€»è¾‘ï¼Œæ—¢ç„¶ç¬¬äºŒæ¬¡æ¡æ‰‹å¯ä»¥å°†æœåŠ¡ç«¯çš„å›žåº”å’Œè¯·æ±‚åˆå¹¶ï¼Œåœ¨ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™ä¹Ÿå¯ä»¥å°†å®¢æˆ·ç«¯çš„å›žåº”å’Œæ•°æ®åˆå¹¶ã€‚

è¿™å¹¶éžä¸å¯å®žçŽ°ï¼ŒQUIC çš„ 1 RTT æ¡æ‰‹ï¼ˆä¸ä»…æ¡æ‰‹ï¼Œç”šè‡³è¿˜äº¤æ¢äº†å¯†é’¥ï¼‰å°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ã€‚

#### å¤§é‡ SYN åŒ…å‘é€ç»™æœåŠ¡ç«¯æœåŠ¡ç«¯ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ
ä¼šå¯¼è‡´ TCP åŠè¿žæŽ¥é˜Ÿåˆ—æ‰“æ»¡ï¼Œè¿™æ ·å½“ TCP åŠè¿žæŽ¥é˜Ÿåˆ—æ»¡äº†ï¼ŒåŽç»­å†åœ¨æ”¶åˆ° SYN æŠ¥æ–‡å°±ä¼šä¸¢å¼ƒã€‚

### å››æ¬¡æŒ¥æ‰‹
![TCP å››æ¬¡æŒ¥æ‰‹](https://gg2002.github.io/img/interview-computer-network/TCPå››æ¬¡æŒ¥æ‰‹.png)
- ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·æŒ¥æ‰‹è¯·æ±‚
- ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼ŒæœåŠ¡ç«¯å›žåº”
- ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼ŒæœåŠ¡ç«¯ä¸»åŠ¨å‘èµ·æŒ¥æ‰‹è¯·æ±‚
- ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼Œå®¢æˆ·ç«¯å›žåº”

æŒ‰ä¸Šè¿°é€»è¾‘ï¼Œç¬¬äºŒæ¬¡æŒ¥æ‰‹ä¸Žç¬¬ä¸‰æ¬¡æŒ¥æ‰‹åœ¨æœåŠ¡ç«¯æ²¡æœ‰æ•°æ®è¦ä¼ è¾“çš„æƒ…å†µä¸‹æ˜¾ç„¶æ˜¯å¯ä»¥åˆå¹¶çš„ã€‚
> ã€Œæ²¡æœ‰æ•°æ®è¦å‘é€ã€å¹¶ä¸”ã€Œå¼€å¯äº† TCP å»¶è¿Ÿç¡®è®¤æœºåˆ¶ã€ï¼Œé‚£ä¹ˆç¬¬äºŒå’Œç¬¬ä¸‰æ¬¡æŒ¥æ‰‹å°±ä¼šåˆå¹¶ä¼ è¾“ï¼Œè¿™æ ·å°±å‡ºçŽ°äº†ä¸‰æ¬¡æŒ¥æ‰‹ã€‚
>
> [ç¬¬äºŒæ¬¡å’Œç¬¬ä¸‰æ¬¡æŒ¥æ‰‹èƒ½åˆå¹¶å˜›](https://xiaolincoding.com/interview/network.html#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%92%8C%E7%AC%AC%E4%B8%89%E6%AC%A1%E6%8C%A5%E6%89%8B%E8%83%BD%E5%90%88%E5%B9%B6%E5%98%9B)

> æ³¨æ„ï¼šè€ƒè™‘åˆ° HTTP/1.1 é»˜è®¤å¼€å¯é•¿è¿žæŽ¥ï¼Œè€Œæ–­å¼€é•¿è¿žæŽ¥çš„åœºæ™¯å¦‚ä¸‹ï¼š
> - é•¿è¿žæŽ¥è¶…æ—¶ï¼Œè¿™ä¸ªæ˜¯æœ€ä¸»è¦çš„åœºæ™¯ï¼Œå› ä¸ºæœåŠ¡ç«¯ä¸ºäº†å“åº”å¿«ï¼Œå°±ç®—å‘å®Œæ•°æ®äº†ä¹ŸåŸºæœ¬ä¸ä¼šä¸»åŠ¨æ–­å¼€é•¿è¿žæŽ¥
> - å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯å‘é€ `Connection: close` ä¸»åŠ¨æ–­å¼€é•¿è¿žæŽ¥ï¼Œä¸»è¦æ˜¯å®¢æˆ·ç«¯å‘ï¼Œæ¯”å¦‚ B/S æž¶æž„ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯è‡ªå·±ç»´æŠ¤çš„ï¼Œå½“ç„¶å¸Œæœ›æœåŠ¡ç«¯æ¯æ—¶æ¯åˆ»çš„å ç”¨èƒ½å°‘ä¸€ç‚¹
> 
> å¯¹äºŽä¸Šè¿°åœºæ™¯ï¼Œå¤§éƒ¨åˆ† webserver çš„å®žçŽ°éƒ½æ˜¯**ç”±æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€ TCP è¿žæŽ¥**ï¼Œå› æ­¤**ä¸Šå›¾çš„å®¢æˆ·ç«¯ä¸ŽæœåŠ¡ç«¯çš„ä½ç½®åº”å½“æ˜¯ç›¸åçš„**ï¼Œè¿™ä¹Ÿä¸éš¾è§£é‡Šä¸ºä»€ä¹ˆä¼šæœ‰ `æœåŠ¡ç«¯å‡ºçŽ°å¤§é‡çš„ TIME_WAIT æ˜¯ä»€ä¹ˆåŽŸå› ` è¿™ä¸ªé—®é¢˜äº†ã€‚

#### ä¸ºä»€ä¹ˆ TIME_WAIT ç­‰å¾…çš„æ—¶é—´æ˜¯ 2MSLï¼Ÿ

#### æœåŠ¡å™¨å‡ºçŽ°å¤§é‡ TIME_WAIT çŠ¶æ€çš„åŽŸå› æœ‰å“ªäº›ï¼Ÿ
ä»€ä¹ˆåœºæ™¯ä¸‹æœåŠ¡ç«¯ä¼šä¸»åŠ¨æ–­å¼€è¿žæŽ¥å‘¢ï¼Ÿ
- ç¬¬ä¸€ä¸ªåœºæ™¯ï¼šHTTP æ²¡æœ‰ä½¿ç”¨é•¿è¿žæŽ¥
- ç¬¬äºŒä¸ªåœºæ™¯ï¼šHTTP é•¿è¿žæŽ¥è¶…æ—¶
- ç¬¬ä¸‰ä¸ªåœºæ™¯ï¼šHTTP é•¿è¿žæŽ¥çš„è¯·æ±‚æ•°é‡è¾¾åˆ°ä¸Šé™

è§£å†³æ–¹æ¡ˆï¼Œä¸€è¨€ä»¥è”½ä¹‹ï¼Œå…ˆæŸ¥æ˜¯ä¸æ˜¯ä»£ç  Bugï¼Œç„¶åŽè§†ä¸šåŠ¡è€Œå®šè°ƒå° HTTP é•¿è¿žæŽ¥çš„ Timeout æ—¶é•¿ã€‚

#### æœåŠ¡å™¨å‡ºçŽ°å¤§é‡ CLOSE_WAIT çŠ¶æ€çš„åŽŸå› æœ‰å“ªäº›ï¼Ÿ
CLOSE_WAIT çŠ¶æ€æ˜¯åªè¦æ•°æ®å‘é€å®Œå°±ä¼šè‡ªå·±é€€å‡ºçš„çŠ¶æ€ï¼Œå› æ­¤åŸºæœ¬æ˜¯ä»£ç  Bugï¼ˆé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä»€ä¹ˆï¼Ÿç¬”è€…ä¸çŸ¥é“ï¼Œå°æž— coding ä¹Ÿæ²¡å†™ï¼‰ã€‚

## æ‹¥å¡žæŽ§åˆ¶ç®—æ³•
- **æ…¢å¯åŠ¨ï¼ˆSlow Startï¼‰**ï¼šåœ¨è¿žæŽ¥å¼€å§‹æ—¶æˆ–ç½‘ç»œå‡ºçŽ°ä¸¢åŒ…åŽï¼Œå‘é€æ–¹ä»¥æŒ‡æ•°å¢žé•¿çš„æ–¹å¼å¢žåŠ æ‹¥å¡žçª—å£å¤§å°ã€‚
- **æ‹¥å¡žé¿å…ï¼ˆCongestion Avoidanceï¼‰**ï¼šå½“æ‹¥å¡žçª—å£è¾¾åˆ°æŸä¸ªé˜ˆå€¼åŽï¼Œé‡‡ç”¨çº¿æ€§å¢žé•¿æ–¹å¼ç¼“æ…¢å¢žåŠ æ‹¥å¡žçª—å£å¤§å°ã€‚
- **å¿«é€Ÿé‡ä¼ ï¼ˆFast Retransmitï¼‰**ï¼šä¸€æ—¦æŽ¥æ”¶æ–¹æ£€æµ‹åˆ°ä¸¢å¤±äº†ä¸€ä¸ªåˆ†ç»„ï¼Œå®ƒä¼šç«‹å³å‘é€å¤šæ¬¡é‡å¤çš„ ACK ç»™å‘é€æ–¹ï¼Œä¿ƒä½¿å‘é€æ–¹åœ¨æœªç­‰åˆ°è¶…æ—¶çš„æƒ…å†µä¸‹å°±è¿›è¡Œé‡ä¼ ã€‚
- **å¿«é€Ÿæ¢å¤ï¼ˆFast Recoveryï¼‰**ï¼šä¸Žå¿«é€Ÿé‡ä¼ é…åˆä½¿ç”¨ï¼Œåœ¨æ£€æµ‹åˆ°ä¸¢åŒ…æ—¶ä¸ç«‹å³è¿›å…¥æ…¢å¯åŠ¨çŠ¶æ€ï¼Œè€Œæ˜¯å°è¯•é€šè¿‡è°ƒæ•´æ‹¥å¡žçª—å£å’Œé˜ˆå€¼æ¥å¿«é€Ÿæ¢å¤æ­£å¸¸çš„æ•°æ®ä¼ è¾“ã€‚

### Tahoeã€Reno å’Œ New Reno
æ—©æœŸçš„ TCP æ‹¥å¡žæŽ§åˆ¶ç®—æ³•ä»…æœ‰**æ…¢å¯åŠ¨**ä¸Ž**æ‹¥å¡žé¿å…**ä¸¤ä¸ªé˜¶æ®µï¼š
![TCP åŽŸå§‹æ‹¥å¡žæŽ§åˆ¶ç®—æ³•](https://gg2002.github.io/img/interview-computer-network/TCPåŽŸå§‹æ‹¥å¡žæŽ§åˆ¶ç®—æ³•.jpg)

#### Tahoe å’Œ Reno
å½“æ”¶åˆ° 3 ä¸ªç›¸åŒçš„ ACK æ—¶ï¼ŒTCP ä¸å†ç­‰å¾…å½“å‰çª—å£çš„è®¡æ—¶å™¨ï¼Œè€Œä¼šç›´æŽ¥è®¤ä¸ºå½“å‰çª—å£çš„åŒ…å·²ç»è¶…æ—¶ï¼Œé‡æ–°å‘é€å½“å‰çª—å£çš„åŒ…ã€‚è¿™æ˜¯ **Tahoe ç‰ˆ TCP** å¼•å…¥çš„**å¿«é€Ÿé‡ä¼ **ç®—æ³•ã€‚

å½“æ”¶åˆ° 3 ä¸ªç›¸åŒçš„ ACK æ—¶ï¼ŒTCP è®¤ä¸ºæ—¢ç„¶è¿˜èƒ½æ”¶åˆ° ACKï¼Œåº”è¯¥åªæ˜¯å±€éƒ¨æ‹¥å¡žï¼Œå› æ­¤ä¼šï¼š
1. $ssthresh = cwnd/2$
2. $cwnd = ssthresh$

è¿™å°±æ˜¯ **Reno ç‰ˆ TCP** å¼•å…¥çš„**å¿«é€Ÿæ¢å¤**ç®—æ³•ï¼Œå¦åˆ™åˆå§‹ç‰ˆæœ¬ä¼šåœ¨ç¬¬äºŒæ­¥å°† $cwnd = 1$ã€‚

å¿«é€Ÿæ¢å¤ç®—æ³•æ˜¯åŸºäºŽå¿«é€Ÿé‡ä¼ ç®—æ³•çš„ï¼Œå› æ­¤ Reno ç‰ˆ TCP çš„æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š
![TCP Reno ç®—æ³•](https://gg2002.github.io/img/interview-computer-network/TCP-New-Renoç®—æ³•.jpg)

#### New Reno
Reno ç‰ˆ TCP åªè€ƒè™‘äº†ä¸€ä¸ªåŒ…ä¸¢å¤±çš„æƒ…å†µã€‚è®¾æƒ³ä¸€ä¸ªåœºæ™¯ï¼š
1. $cwnd = 9$ï¼Œå‘é€äº† 1-9 å·åŒ…
2. å½“æ‹¥å¡žå‘ç”Ÿæ—¶ï¼Œ3ã€4 å·åŒ…ä¸¢å¤±ï¼Œè§¦å‘äº† 3 å·åŒ…çš„å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤
3. cwnd è¢«è®¾ç½®ä¸º 4ï¼Œå‘é€äº† 3-6 å·åŒ…
4. é—æ†¾çš„æ˜¯ 4 å·åŒ…å†æ¬¡ä¸¢å¤±ï¼Œä½† Reno æ”¶åˆ°äº† 3 å·åŒ…çš„ ack åŽå°±ä¼šé€€å‡ºå¿«é€Ÿæ¢å¤é˜¶æ®µï¼Œå› æ­¤åˆä¼šè§¦å‘ 4 å·åŒ…çš„å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤
5. cwnd è¢«è®¾ç½®ä¸º 2

ä¸¢å¤±å¤šä¸ªåŒ…è¿™ä¸€åœºæ™¯ä¼šå¯¼è‡´å³ä½¿æœ‰å¿«é€Ÿæ¢å¤ç®—æ³•ï¼Œæ‹¥å¡žçª—å£ä»ç„¶ä¼šæŒ‡æ•°çº§å‡å°‘ã€‚

å› æ­¤ï¼Œå¸Œæœ›åŒä¸€æ—¶é—´ä¸¢å¤±çš„åŒ…åªä¼šå¯¼è‡´æ‹¥å¡žçª—å£å‡å°‘ä¸€æ¬¡å°±æ˜¯**New Reno ç‰ˆ TCP**çš„æ ¸å¿ƒæ€æƒ³ã€‚

ç®€è¨€ä¹‹ï¼Œä¸Šè¿°åœºæ™¯ New Reno ä¼šå‡å°‘ä¸€æ¬¡æ‹¥å¡žçª—å£ï¼Œç„¶åŽåœ¨ ack åˆ° 9 ä¹‹å‰éƒ½å¤„äºŽå¿«é€Ÿæ¢å¤çŠ¶æ€ï¼ˆæˆ–è€…è¯´ï¼Œä¸é€€å›žæ‹¥å¡žé¿å…çŠ¶æ€ï¼Œå› ä¸ºåªè¦ä¸é€€å›žå°±ä¸ä¼šå†æ¬¡è¿›å…¥å¿«é€Ÿæ¢å¤çŠ¶æ€å¯¼è‡´æ‹¥å¡žçª—å£å‡å°‘ï¼‰ã€‚

### SACK ä¸Ž D-SACK
#### SACK
Tahoe å’Œ Reno éƒ½æ— æ³•å®žçŽ° [SR ARQ ç®—æ³•](#arqautomatic-repeat-requestè‡ªåŠ¨é‡ä¼ è¯·æ±‚)ï¼Œåªèƒ½é‡ä¼ ä¸¢å¤±çš„å½“å‰åŒ…æˆ–è€…é‡ä¼ å½“å‰å‘é€çª—å£ä¸­æ‰€æœ‰çš„åŒ…ï¼ŒSACK å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

SACK é€šè¿‡åœ¨ TCP option field ä¸­å¢žåŠ ä¸€ä¸ª SACK é€‰é¡¹æ¥è®©æŽ¥æ”¶ç«¯åœ¨è¿”å›ž Duplicate ACK æ—¶ï¼Œå°†å·²ç»æ”¶åˆ°çš„æ•°æ®åŒºæ®µï¼ˆè¿žç»­æ”¶åˆ°çš„æ•°æ®èŒƒå›´ï¼‰è¿”å›žç»™å‘é€ç«¯ï¼Œæ•°æ®åŒºæ®µä¸Žæ•°æ®åŒºæ®µä¹‹é—´çš„é—´éš”å°±æ˜¯æŽ¥æ”¶ç«¯æ²¡æœ‰æ”¶åˆ°çš„æ•°æ®ã€‚

è¿™æ ·å‘é€ç«¯å°±çŸ¥é“å“ªäº›æ•°æ®åŒ…å·²ç»æ”¶åˆ°ï¼Œå“ªäº›è¯¥é‡ä¼ ï¼Œå› æ­¤ SACK çš„å‘é€ç«¯å¯ä»¥åœ¨ä¸€ä¸ª RTT æ—¶é—´å†…é‡ä¼ å¤šä¸ªæ•°æ®åŒ…ã€‚
![TCP SACK ç®—æ³•](https://gg2002.github.io/img/interview-computer-network/TCP-SACKç®—æ³•.png)

#### D-SACK (Duplicate SACK)
D-SACK å¯ä»¥è®©ã€Œå‘é€æ–¹ã€çŸ¥é“ï¼Œæ˜¯å‘å‡ºåŽ»çš„åŒ…ä¸¢äº†ï¼Œè¿˜æ˜¯æŽ¥æ”¶æ–¹å›žåº”çš„ ACK åŒ…ä¸¢äº†ã€‚ä¹Ÿå°±æ˜¯èƒ½åŒºåˆ†ä¸‹è¿°ä¸¤ä¸ªåœºæ™¯ï¼š
| ACK å›žåº”ä¸¢å¤±                                                                                            | å‘å‡ºåŽ»çš„åŒ…å»¶è¿Ÿåˆ°è¾¾                                                                                      |
| ------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| ![TCP D-SACK å‘é€å»¶è¿Ÿ](https://gg2002.github.io/img/interview-computer-network/TCP-D-SACK-å›žåº”ä¸¢å¤±.png) | ![TCP D-SACK å‘é€å»¶è¿Ÿ](https://gg2002.github.io/img/interview-computer-network/TCP-D-SACK-å‘é€å»¶è¿Ÿ.png) |
| åŒæ—¶æŽ¥åˆ°æœ€æ–°çš„ ACK å’Œé‡å¤çš„ SACK                                                                        | é¦–å…ˆæŽ¥åˆ°äº†æœ€æ–°çš„ ACK=3000ï¼Œç„¶åŽå†æ¬¡æŽ¥åˆ°æœ€æ–°çš„ ACK å’Œé‡å¤çš„ SACK                                         |

ä»Ž ACK æŽ¥å—é¡ºåºå°±èƒ½åˆ†è¾¨å‡ºè¿™ä¸¤ä¸ªåœºæ™¯ï¼Œç”±æ­¤å¯ä»¥åšæ›´ç²¾ç»†çš„æŽ§åˆ¶ï¼ˆåšä»€ä¹ˆæŽ§åˆ¶ï¼Ÿå°æž— coding æ²¡æœ‰å†™ï¼Œç¬”è€…ä¹Ÿä¸çŸ¥é“ï¼‰ã€‚

### CUBIC
ä»¥ä¸‹å†…å®¹å‚è€ƒè‡ªï¼š
- [ä»Ž TCP Reno ç» BIC åˆ° CUBIC](https://blog.csdn.net/dog250/article/details/142641516)
- [åŸºäºŽä¸¢åŒ…çš„ TCP æ‹¥å¡žæŽ§åˆ¶ï¼šä»Ž Reno åˆ° Bic ä¸Ž Cubic](https://blog.csdn.net/qq_44577070/article/details/122371820)

Reno çš„æ‹¥å¡žé¿å…é˜¶æ®µæ˜¯çº¿æ€§å¢žé•¿çš„ã€‚çº¿æ€§é€¼è¿‘ç®¡é“å®¹é‡ $W_{max}$ ç›¸å½“äºŽä¸€æ¬¡æŸ¥è¯¢ (capacity-seeking)ï¼Œä½†**é•¿è‚¥ç®¡é“**ä»Ž $0.5*W_{max}$ åˆ° $W_{max}$ çš„çº¿æ€§éåŽ†å¤ªæ…¢ï¼ŒæœŸé—´ä¸€æ—¦é­é‡ä¸¢åŒ…ï¼Œåˆ™å‰åŠŸå°½å¼ƒã€‚
> **é•¿è‚¥ç®¡é“**ï¼šå…·æœ‰é«˜å¸¦å®½ - å»¶è¿Ÿç§¯ï¼ˆBandwidth-Delay Product, BDPï¼‰çš„ç½‘ç»œè·¯å¾„ã€‚è¿™ä¸ªæœ¯è¯­å½¢è±¡åœ°æè¿°äº†é‚£äº›è™½ç„¶ä¼ è¾“é€ŸçŽ‡å¾ˆé«˜ï¼ˆâ€œè‚¥â€ï¼‰ï¼Œä½†ç”±äºŽè·ç¦»è¿œæˆ–ç»è¿‡å¤šä¸ªè·¯ç”±å¯¼è‡´å»¶è¿Ÿè¾ƒå¤§ï¼ˆâ€œé•¿â€ï¼‰çš„ç½‘ç»œè¿žæŽ¥ç‰¹æ€§ã€‚

![TCP Reno æ‹¥å¡žé¿å…æ•´ä½“è¶‹åŠ¿](https://gg2002.github.io/img/interview-computer-network/TCP-Reno-æ‹¥å¡žé¿å…æ•´ä½“è¶‹åŠ¿.png)
å¯ä»¥æ˜Žæ˜¾çœ‹åˆ°æ¯æ¬¡ TDï¼ˆDuplicated Acksï¼‰çš„æ—¶å€™ï¼ŒReno éƒ½è¦çº¿æ€§å¢žé•¿è‡³æœ€å¤§å€¼å†é‡æ–°å‡åŠï¼Œä»¥æ­¤å¾€å¤ã€‚

ä½†è¿™æ ·å¯¹å¸¦å®½çš„åˆ©ç”¨çŽ‡ä¸æ˜¯å¾ˆé«˜ï¼Œå¸Œæœ›æœ€å¥½åˆ©ç”¨èµ·æ¥è¿™æ¡çº¿æ®µçš„ä¸ŠåŠåŒºåŸŸï¼ŒäºŽæ˜¯æœ‰äº† **BIC ç®—æ³•**ã€‚
![TCP BIC ç®—æ³•](https://gg2002.github.io/img/interview-computer-network/TCP-BIC.png)

å‘ç”Ÿä¸¢åŒ…æ—¶å®šä¹‰æœ€å¤§æ‹¥å¡žçª—å£ä¸º $W_{max}$ï¼Œé‡‡ç”¨ä¹˜æ€§å‡å‡å°æ‹¥å¡žçª—å£è‡³ $W_{min}$ã€‚BIC ä½¿ç”¨ç”¨äºŒåˆ†æœç´¢çš„æ€æƒ³å¿«é€Ÿé€¼è¿‘ $W_{max}$ï¼Œæ¯ç»è¿‡ä¸€ä¸ª RTTï¼Œä¾¿å°†çª—å£è®¾ç½®åˆ° $W_{max}$ å’Œ $W_{min}$ çš„ä¸­ç‚¹ï¼Œå¦‚æžœæ²¡æœ‰ä¸¢åŒ…ï¼Œåˆ™æ›´æ–° $W_{min}$ ä¸ºå½“å‰ cwnd å€¼ï¼Œä¸€ç›´æŒç»­åˆ°æŽ¥è¿‘ $W_{max}$ï¼Œç›´åˆ°äºŒè€…ä¹‹å·®å°äºŽ $S_{min}$ï¼Œè¿™å¾ˆå¥½åœ°åˆ©ç”¨äº†çº¿æ€§å¢žé•¿æ›²çº¿çš„ä¸ŠåŠéƒ¨åˆ†ç©ºé—´ã€‚

ä½†æ˜¯åœ¨ä¸€ä¸ª RTT é‡Œé¢å¢žé•¿è¿‡å¤šä¼šé€ æˆä¼ è¾“ä¸Šçš„æŠ–åŠ¨ï¼Œå› è€Œ BIC-TCP é€‰å–äº†å¦å¤–å–äº†ä¸¤ä¸ªå‚è€ƒå€¼ï¼Œç§°ä¸º $S_{max}$ å’Œ $S_{min}$ï¼Œå¦‚æžœä¸­ç‚¹å’Œå½“å‰ cwnd å€¼çš„å·®å¤§äºŽ $S_{max}$ çš„è¯ï¼Œé‚£ä¹ˆ cwnd å°±åªå¢žé•¿ $S_{max}$ã€‚

ç”±ä¸Šå¯ä»¥çœ‹å‡º BIC è¿™ä¸ªäºŒåˆ†æ³•è°ƒå‚è¾ƒä¸ºå¤æ‚ï¼Œå› æ­¤åˆæœ‰äº†ç›´æŽ¥ä½¿ç”¨ä¸‰æ¬¡å¤šé¡¹å¼æ‹Ÿåˆ BIC æ›²çº¿çš„ **CUBIC ç®—æ³•**ã€‚
![TCP CUBIC ç®—æ³•](https://gg2002.github.io/img/interview-computer-network/TCP-CUBIC.png)

CUBIC ç”¨ä¸€ä¸ªä¸‰æ¬¡å¤šé¡¹å¼ä»£æ›¿äº† BIC å¢žé•¿æ›²çº¿ï¼Œå¯¹çª—å£å¢žé•¿æœºåˆ¶è¿›è¡Œäº†ç®€åŒ–ï¼Œä¿è¯äº†å¿«é€ŸæŽ¢æµ‹åˆé€‚çš„æ‹¥å¡žçª—å£ã€‚å¹¶ä¸”ä¸å†ä»¥ RTT ä¸ºå•ä½ï¼Œçª—å£å¢žé•¿å‡½æ•°ä»…ä»…å–å†³äºŽè¿žç»­çš„ä¸¤æ¬¡æ‹¥å¡žäº‹ä»¶çš„æ—¶é—´å·®ï¼Œä¿è¯äº†å…¬å¹³æ€§ã€‚

### BBR (Bottleneck Bandwidth and RTT)
ç”± Google æå‡ºçš„ä¸€ç§æ–°åž‹æ‹¥å¡žæŽ§åˆ¶ç®—æ³•ï¼Œå®ƒè¯•å›¾æ‰¾åˆ°å¹¶åˆ©ç”¨ç“¶é¢ˆå¸¦å®½ï¼Œä»Žè€Œæœ€å¤§åŒ–åžåé‡ï¼Œå‡å°‘æŽ’é˜Ÿå»¶è¿Ÿã€‚

### KCP
> KCP æ˜¯ä¸€ä¸ªå¿«é€Ÿå¯é åè®®ï¼Œèƒ½ä»¥æ¯” TCP æµªè´¹ 10%-20% çš„å¸¦å®½çš„ä»£ä»·ï¼Œæ¢å–å¹³å‡å»¶è¿Ÿé™ä½Ž 30%-40%ï¼Œä¸”æœ€å¤§å»¶è¿Ÿé™ä½Žä¸‰å€çš„ä¼ è¾“æ•ˆæžœã€‚çº¯ç®—æ³•å®žçŽ°ï¼Œå¹¶ä¸è´Ÿè´£åº•å±‚åè®®ï¼ˆå¦‚ UDPï¼‰çš„æ”¶å‘ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªå·±å®šä¹‰ä¸‹å±‚æ•°æ®åŒ…çš„å‘é€æ–¹å¼ï¼Œä»¥ callback çš„æ–¹å¼æä¾›ç»™ KCPã€‚è¿žæ—¶é’Ÿéƒ½éœ€è¦å¤–éƒ¨ä¼ é€’è¿›æ¥ï¼Œå†…éƒ¨ä¸ä¼šæœ‰ä»»ä½•ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ã€‚
> 
> æ•´ä¸ªåè®®åªæœ‰ ikcp.h, ikcp.c ä¸¤ä¸ªæºæ–‡ä»¶ï¼Œå¯ä»¥æ–¹ä¾¿çš„é›†æˆåˆ°ç”¨æˆ·è‡ªå·±çš„åè®®æ ˆä¸­ã€‚ä¹Ÿè®¸ä½ å®žçŽ°äº†ä¸€ä¸ª P2Pï¼Œæˆ–è€…æŸä¸ªåŸºäºŽ UDP çš„åè®®ï¼Œè€Œç¼ºä¹ä¸€å¥—å®Œå–„çš„ ARQ å¯é åè®®å®žçŽ°ï¼Œé‚£ä¹ˆç®€å•çš„æ‹·è´è¿™ä¸¤ä¸ªæ–‡ä»¶åˆ°çŽ°æœ‰é¡¹ç›®ä¸­ï¼Œç¨å¾®ç¼–å†™ä¸¤è¡Œä»£ç ï¼Œå³å¯ä½¿ç”¨ã€‚
>
> [skywind3000/kcp](https://github.com/skywind3000/kcp)

> ä¸»è¦æ˜¯å› ä¸ºåŽŸç¥žç”¨äº†è¿™ä¸ªåè®®ï¼Œç¬”è€…çŸ¥é“äº†æ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚

KCP è™½ç„¶è¯´æ˜¯åè®®ï¼Œä½†æ›´åƒæ˜¯æŸç§æ‹¥å¡žæŽ§åˆ¶ç®—æ³• + ARQ + å¿…è¦çš„èƒ¶æ°´ä»£ç ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç®€å•çš„è§†ä½œæŸç§æ‹¥å¡žæŽ§åˆ¶ç®—æ³•ã€‚ç”±äºŽå½“å‰ï¼ˆ2025/03/25ï¼‰TCP åè®®æ˜¯å„ç§æ„ä¹‰ä¸Šçš„ä¼ è¾“å±‚æ ‡å‡†ï¼Œæ‰€è°“çš„æ‹¥å¡žæŽ§åˆ¶ç®—æ³•éƒ½æ˜¯è¦è€ƒè™‘ TCP çš„ï¼Œå› æ­¤åªèƒ½æŠŠ KCP æ”¾åœ¨è¿™ä¸ªå°èŠ‚äº†ã€‚

KCP é‡‡å–äº†æ¿€è¿›çš„é‡ä¼ ç­–ç•¥ï¼Œç„¶è€Œï¼Œæ‰€è°“çš„æ¿€è¿›æ˜¯åŸºäºŽè¿™æ ·ä¸€ä¸ªå®¢è§‚çŽ°å®žâ€”â€”ç»å¤§éƒ¨åˆ†ç³»ç»Ÿä»åœ¨ä½¿ç”¨ TCP çš„ CUBIC ç®—æ³•ã€‚

CUBIC ç›¸å¯¹ä¿å®ˆï¼ˆåœ¨ä¹Žä¼ è¾“å…¬å¹³æ€§ï¼Œå›å­åè®®ï¼‰ï¼Œè€Œ KCP èˆå¼ƒäº†ä¼ è¾“å…¬å¹³æ€§åˆ™ç›¸å½“äºŽä¾µçŠ¯äº†è¿™éƒ¨åˆ†å…¬å…±ç©ºé—´ã€‚å‡å¦‚å¤§å®¶éƒ½ä½¿ç”¨ KCPï¼Œé‚£ä¹ˆå¤§å®¶éƒ½ä¸ä¼šå˜å¿«ï¼Œåªæœ‰åœ¨å¤§éƒ¨åˆ†äººç”¨ CUBIC çš„æ—¶å€™ï¼Œä½¿ç”¨ KCP çš„äººæ‰èƒ½å¾—åˆ°æ”¶ç›Šã€‚

KCP åè®®é™¤äº†æ¸¸æˆä¹Ÿå¤šç”¨åœ¨ç¿»å¢™ä¸Šï¼Œæ‰€ä»¥ wall ä¹Ÿæ˜¯ä¼šå¯¹è¿™ä¸ªæµé‡è¿›è¡Œç®¡æŽ§çš„ã€‚
![KCP çŽ°çŠ¶](https://gg2002.github.io/img/interview-computer-network/KCPçŽ°çŠ¶.png)

# HTTP/1.x åè®®
## é•¿è¿žæŽ¥/æŒä¹…è¿žæŽ¥ï¼ˆKeep Aliveï¼‰
### å¼€å¯ä¸Žé…ç½®é•¿è¿žæŽ¥
å”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯é€‰æ‹©é¢˜ä¼šè€ƒä¸€ä¸‹é•¿è¿žæŽ¥å­—æ®µã€‚å¼€å¯é•¿è¿žæŽ¥æ˜¯ä½¿ç”¨ `Connection` å­—æ®µï¼Œå³ï¼š
```
Connection: keep-alive  # å¼€å¯ï¼ŒHTTP/1.0 é»˜è®¤å…³é—­ï¼Œéœ€æ˜¾å¼å¼€å¯
Connection: close       # å…³é—­ï¼ŒHTTP/1.1 é»˜è®¤å¼€å¯ï¼Œéœ€æ˜¾å¼å…³é—­
```

è€Œ `Keep-Alive` å­—æ®µåˆ™æ˜¯å¼€å¯é•¿è¿žæŽ¥åŽæ‰æœ‰ç”¨çš„å­—æ®µï¼Œç”¨ä»¥é…ç½®é•¿è¿žæŽ¥ï¼Œå¯ä»¥åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼š
1. timeoutï¼šè¡¨ç¤ºè¿žæŽ¥åº”ä¿æŒæ‰“å¼€çŠ¶æ€çš„æœ€é•¿æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚åœ¨è¿™æ®µæ—¶é—´å†…ï¼ŒæœåŠ¡å™¨åº”å½“ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ–°çš„è¯·æ±‚ã€‚
2. maxï¼šè¡¨ç¤ºåœ¨å…³é—­è¿žæŽ¥ä¹‹å‰ï¼Œå…è®¸åœ¨è¯¥è¿žæŽ¥ä¸Šå‘é€çš„æœ€å¤§è¯·æ±‚æ•°ã€‚

å› æ­¤ï¼Œä¸€ä¸ªå…¸åž‹çš„ HTTP è¯·æ±‚å¤´å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```
Connection: keep-alive
Keep-Alive: timeout=5, max=100
```

ç„¶è€Œï¼Œåœ¨å®žé™…åº”ç”¨ä¸­ï¼Œ**è¶…æ—¶è®¾ç½®é€šå¸¸æ˜¯åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æ‰‹åŠ¨é…ç½®**çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡ HTTP å¤´éƒ¨æ¥æŒ‡å®šã€‚

### é•¿è¿žæŽ¥çš„å°ç¼ºç‚¹
é•¿è¿žæŽ¥ä¹Ÿæœ‰ä¸€ä¸ªå°å°çš„ç¼ºç‚¹â€”â€”æ¯”è¾ƒè€—æœåŠ¡å™¨èµ„æºã€‚

è™½ç„¶é•¿è¿žæŽ¥å¯ä»¥é å®¢æˆ·ç«¯ä¸»åŠ¨å‘é€ `Connection: close` æ–­å¼€è¿žæŽ¥ï¼Œä½†æ˜¯ä¸ºäº†å‡å°‘å»¶è¿Ÿã€æé«˜æ€§èƒ½ä¸Žç”¨æˆ·ä½“éªŒï¼ŒçŽ°ä»£ websever é»˜è®¤æ”¯æŒå¹¶é¼“åŠ±ä½¿ç”¨é•¿è¿žæŽ¥ï¼Œå› æ­¤é•¿è¿žæŽ¥çš„æ–­å¼€åŸºæœ¬åªèƒ½é  timeoutã€‚

æœåŠ¡å™¨ç»´æŠ¤å¤§é‡çš„ä¸æ´»è·ƒé•¿è¿žæŽ¥è‡ªç„¶æ˜¯ä¼šæ¯”è¾ƒæ¶ˆè€—èµ„æºçš„ï¼Œå¹¶ä¸”è¿™ä¹Ÿæ˜¯æœåŠ¡å™¨å‡ºçŽ°å¤§é‡å¤„äºŽ Timewait çš„ TCP è¿žæŽ¥çš„æ ¹æœ¬åŽŸå› ï¼š
> é—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆåœºæ™¯ä¸‹æœåŠ¡ç«¯ä¼šä¸»åŠ¨æ–­å¼€è¿žæŽ¥å‘¢ï¼Ÿ
> - ç¬¬ä¸€ä¸ªåœºæ™¯ï¼šHTTP æ²¡æœ‰ä½¿ç”¨é•¿è¿žæŽ¥ï¼Œæ ¹æ®å¤§å¤šæ•°çŽ°ä»£ websever çš„å®žçŽ°ï¼Œä¸ç®¡å“ªä¸€æ–¹ç¦ç”¨äº† Keep-Aliveï¼Œéƒ½æ˜¯ç”±æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­è¿žæŽ¥ã€‚
> - ç¬¬äºŒä¸ªåœºæ™¯ï¼šHTTP é•¿è¿žæŽ¥è¶…æ—¶ï¼Œè¿˜å¾—æ˜¯å¤§é‡ HTTP é•¿è¿žæŽ¥è¶…æ—¶ã€‚
> - ç¬¬ä¸‰ä¸ªåœºæ™¯ï¼šHTTP é•¿è¿žæŽ¥çš„è¯·æ±‚æ•°é‡è¾¾åˆ°ä¸Šé™
>
> [æœåŠ¡ç«¯å‡ºçŽ°å¤§é‡çš„ timewait æœ‰å“ªäº›åŽŸå› ï¼Ÿ](https://xiaolincoding.com/interview/network.html#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E7%9A%84timewait%E6%9C%89%E5%93%AA%E4%BA%9B%E5%8E%9F%E5%9B%A0)

# HTTP/2 åè®®
HTTP/2 å…¼å®¹ HTTP/1.1ï¼Œä¸åƒ HTTP/3 ç›´æŽ¥æ•¢å«æ—¥æœˆæ¢æ–°å¤©äº†ã€‚
## å¯¹ HTTP/1.x çš„ä¼˜åŒ–
### å¤´éƒ¨åŽ‹ç¼©

### äºŒè¿›åˆ¶å¸§

### TCP è¿žæŽ¥å¤ç”¨

### Server Push

## ä¸Ž HTTP/1.xã€Websocketã€SSE çš„å¯¹æ¯”
### HTTP/2 å¹¶éž HTTP/1.x çš„å®Œæ•´æ›¿ä»£
åœ¨ HTTP/1.x ä¸­ç”¨ä»¥åŠ é€Ÿè®¿é—®é€Ÿåº¦çš„æŠ€æœ¯ç±»ä¼¼äºŽåŸŸååˆ†ç‰‡ã€èµ„æºåˆå¹¶å’Œèµ„æºå†…è”ç­‰å…¥ä¾µå…¥å¼æŠ€æœ¯åœ¨ HTTP/2 ä¸–ç•Œä¸­æ­£å¥½é€‚å¾—å…¶åã€‚
- **åŸŸååˆ†ç‰‡**ï¼ŒHTTP/2 å¯¹äºŽåŒä¸€åŸŸåä½¿ç”¨ä¸€ä¸ª TCP è¿žæŽ¥è¶³çŸ£ï¼Œè¿‡å¤š TCP è¿žæŽ¥æµªè´¹èµ„æºè€Œä¸”æ•ˆæžœä¸è§å¾—ä¸€å®šå¥½ï¼Œè€Œä¸”èµ„æºåˆ†åŸŸä¼šç ´å HTTP/2 çš„ä¼˜å…ˆçº§ç‰¹æ€§ï¼Œè¿˜ä¼šé™ä½Žå¤´éƒ¨åŽ‹ç¼©æ•ˆæžœ
- **èµ„æºåˆå¹¶**ï¼ˆå¤šå¼ å°å›¾æ‹¼æŽ¥å¤§å›¾ï¼‰ï¼Œèµ„æºåˆå¹¶ä¼šä¸åˆ©äºŽç¼“å­˜æœºåˆ¶ï¼Œè€Œä¸”å•æ–‡ä»¶è¿‡å¤§å¯¹äºŽ HTTP/2 çš„ä¼ è¾“ä¸å¥½ï¼Œå°½é‡åšåˆ°ç»†ç²’åŒ–æ›´æœ‰åˆ©äºŽ HTTP/2 ä¼ è¾“ã€‚
- **èµ„æºå†…è”**ï¼ˆå›¾ç‰‡è½¬ base64 ç¼–ç ç›´æŽ¥å­˜ HTML é‡Œï¼‰ï¼ŒHTTP/2 æ”¯æŒ Server-Pushï¼Œç›¸æ¯”è¾ƒå†…è”ä¼˜åŠ¿æ›´å¤§æ•ˆæžœæ›´å¥½ï¼Œè€Œä¸”å†…è”çš„èµ„æºä¸èƒ½æœ‰æ•ˆç¼“å­˜ã€‚å¦‚æžœæœ‰å…±ç”¨ï¼Œå¤šé¡µé¢å†…è”ä¹Ÿä¼šé€ æˆæµªè´¹

### HTTP/2 ä¸æ˜¯ç±»ä¼¼äºŽ Websocket æˆ–è€… SSE è¿™æ ·çš„æŽ¨é€æŠ€æœ¯çš„æ›¿ä»£å“
HTTP/2 çš„ Server Push åªèƒ½è¢«æµè§ˆå™¨æ¥å¤„ç†è€Œä¸èƒ½å¤Ÿåœ¨ç¨‹åºä»£ç ä¸­è¿›è¡Œå¤„ç†ï¼Œå®ƒå¹¶ä¸å…è®¸æœåŠ¡ç«¯ç›´æŽ¥å‘å®¢æˆ·ç«¯ç¨‹åºæœ¬èº«å‘é€æ•°æ®ï¼Œæ„å³ç¨‹åºä»£ç æ²¡æœ‰ API å¯ä»¥ç”¨æ¥èŽ·å–è¿™äº›äº‹ä»¶çš„é€šçŸ¥ã€‚

Websocket æŠ€æœ¯å¯èƒ½ä¼šç»§ç»­ä½¿ç”¨ï¼Œä½†æ˜¯ SSE å’Œå…¶ EventSource API åŒ HTTP/2 çš„èƒ½åŠ›ç›¸ç»“åˆå¯ä»¥åœ¨å¤šæ•°åœºæ™¯ä¸‹è¾¾åˆ°åŒæ ·çš„æ•ˆæžœï¼Œä½†æ˜¯ä¼šæ›´ç®€å•ã€‚

# HTTP/3ï¼ˆQUICï¼‰åè®®
åŸºäºŽ UDP çš„å…¨æ–°åº”ç”¨å±‚åè®®ï¼Œæœªæ¥å¯æœŸã€‚
## å¯¹ HTTP/2 çš„ä¼˜åŒ–
### æ¶ˆé™¤é˜Ÿå¤´é˜»å¡ž

### æ›´å¿«å»ºç«‹è¿žæŽ¥ï¼ˆç¬¬ä¸€æ¬¡ 1 RTTï¼ŒåŽç»­å¯èƒ½ 0 RTTï¼‰ 

### è¿žæŽ¥è¿ç§»

## ä»£ç å®žçŽ°
- [Tencent/tquic](https://github.com/Tencent/tquic/blob/develop/README-CN.md)



# gRPC ä¸Ž thrift åè®®

# Websocket

# SSE

# é¢ç»é—®ç­”ï¼š
### å‡è®¾åœ¨æ— çº¿ç½‘æ¡ä»¶ä¸‹ï¼Œç½‘ç»œæ¯”è¾ƒæ‹¥å µï¼Œä½ ä¼šé€‰æ‹© TCP è¿˜æ˜¯ UDP é€šä¿¡
æ²¡ä»€ä¹ˆæ ‡å‡†ç­”æ¡ˆï¼Œä¸»è¦è¿˜æ˜¯çœ‹åº”ç”¨ã€‚è¯´åˆ°åº•ä¸é‡è¦çš„æ¶ˆæ¯ä¸¢äº†ä¹Ÿå°±ä¸¢äº†ï¼Œè€Œé‡è¦çš„æ¶ˆæ¯è‚¯å®šä¸èƒ½ä¸¢ï¼Œå“ªä¸€ä¸ªè·Ÿç½‘ç»œçŽ¯å¢ƒéƒ½æ²¡å…³ç³»ï¼Œæ€»ä¸èƒ½ç½‘ç»œçŽ¯å¢ƒå˜å·®äº†ï¼Œä»¥å‰ä¸é‡è¦çš„æ¶ˆæ¯çŽ°åœ¨å°±å˜é‡è¦äº†ï¼Œæˆ–è€…ç›¸åã€‚

## epoll ç›¸å…³

æœ‰æ„æ€çš„é—®é¢˜ä¸Žå›žç­”ï¼š
> ... ... è¯» redis çš„è¯ï¼Œå³ä½¿ redis å’Œè¯·æ±‚ç¨‹åºåŒä¸€å°æœºå™¨ä¸Šï¼Œä¹Ÿéœ€è¦é€šè¿‡è¯»å†™å¥—æŽ¥å­—æ¥å®Œæˆï¼Œè¿™ä¸ªæµç¨‹åŒ…æ‹¬
> 
> 1.é¦–å…ˆä¼šæ¶‰åŠæ“ä½œç³»ç»Ÿå†…æ ¸åè®®æ ˆçš„å¤„ç†ï¼Œå°± linux æ¥è¯´ï¼Œå¦‚æžœ redis æœåŠ¡åœ¨æœ¬æœºï¼Œå†™å¥—æŽ¥å­—è¿™ä¸ªè¿‡ç¨‹ä¼šåœ¨åˆ°è¾¾åè®®æ ˆä¼ è¾“å±‚æ—¶ï¼Œå‘çŽ°ç›®çš„ ip æ¥è‡ªæœ¬æœºï¼Œç„¶åŽè¿”å›žã€‚redis è¯»å–è¯·æ±‚ï¼Œé€šè¿‡å¥—æŽ¥å­—æŠŠç»“æžœè¿”å›žã€‚
> 
> 2.æ•´ä¸ªè¿‡ç¨‹è¿‡ç¨‹ä¼šæœ‰å››æ¬¡ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„äº¤äº’ï¼Œå…¶ä¸­ä¸¤æ¬¡è¿˜åŒ…æ‹¬ç»“æžœæ•°æ®æ‹·è´ã€‚
> 
> 3.Redis åº•å±‚é€šè¿‡ epoll å‡½æ•°æ¥ç›‘æµ‹æ˜¯å¦æœ‰è¯·æ±‚åˆ°æ¥ï¼Œå¦‚æžœä¸æƒ³å•æ ¸ CPU å ç”¨çŽ‡åˆ° 100%ï¼Œé‚£ä¹ˆ epoll çš„ idle time è¿™ä¸ªå‚æ•°æœ€ä½Žåªèƒ½é…ç½®æˆ 1msï¼Œè¿™æ„å‘³ç€å“åº”çš„å¹³å‡è€—æ—¶åº”è¯¥åœ¨ 500usã€‚
>
> æ‰¹åˆ¤å¦ä¸€ä½ç­”ä¸»æµ‹è¯•ç¨‹åºçš„é—®é¢˜.jpg
>
> å¦‚æžœæŠŠè¿™ä¸ªæµ‹è¯• demo ä¿®æ”¹ä¸‹ï¼Œæ¯éš” 10ms è¯»å†™ä¸€æ¬¡ï¼ˆæ˜¾ç„¶è¿™ç§æ–¹å¼æ›´è´´è¿‘ä¸šåŠ¡åœºæ™¯ï¼‰ï¼Œé‚£è€—æ—¶å°±ä¼šæš´å¢žï¼Œç†ç”±ä¸Šé¢è¯´äº†ï¼ŒRedis åº•å±‚ç”¨ epoll æ¥ç›‘æµ‹å¥—æŽ¥å­—è¯·æ±‚ï¼ŒåŒä¸€ä¸ªå¥—æŽ¥å­—çŸ­æ—¶é—´å†…å‘èµ·å¤§é‡è¯»å†™ï¼ŒRedis çš„ epoll å‡½æ•°ä¼šæ‰¹é‡è¯»å–è¯·æ±‚ç„¶åŽåŽ»å¤„ç†ï¼ˆè®¾ç½®çš„è§¦å‘æ–¹å¼è‚¯å®šæ˜¯æ°´å¹³è§¦å‘ï¼Œæ„å‘³ç€åªéœ€è¦å’Œå†…æ ¸æ€äº¤äº’ä¸€æ¬¡å°±å¯ä»¥è¯»å–ä¸€ä¸ª fd çš„å¤šä¸ª Reqï¼‰ï¼Œå¯¼è‡´å¹³å‡è€—æ—¶çœ‹èµ·æ¥ä¸é«˜ï¼Œå¯ä¸€æ—¦è¿›å…¥ä¸šåŠ¡åœºæ™¯ï¼Œé›¶æ•£è¯»å†™ Redisï¼Œè€—æ—¶å°±ä¼šå¤§å¹…å¢žåŠ ã€‚
> 
> [æ¸¸æˆæœåŠ¡å™¨ç¼“å­˜ä¸ºä»€ä¹ˆä¸€èˆ¬ä¸ç›´æŽ¥ Redisï¼Œè€Œæ˜¯è‡ªå·±å†™ä»£ç å†™å…¥è®¡ç®—æœºå†…å­˜ä¸­å‘¢ï¼Ÿ](https://www.zhihu.com/question/595091316/answer/3039792939)

> è§£é‡Šä¹‹å‰ï¼Œå…ˆçœ‹çœ‹ Redis çš„å¤šçº¿ç¨‹å¹²äº†å•¥ï¼Œredis æ•´ä¸ªå¤„ç†å¤§è‡´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š
> 
> --> (1) read req & è§£æž req --> (2) æ‰§è¡Œ redis æ•°æ®ç»“æž„å†…å­˜æ“ä½œ --> (3) write resp
> 
> è€ƒè™‘åˆ°ç“¶é¢ˆä¸»è¦åœ¨ç½‘ç»œï¼Œä»¥åŠå®žçŽ°ä¸Šçš„ç®€å•ï¼Œæ‰€ä»¥ç¬¬ (2) æ­¥æ‰§è¡Œ redis æ•°æ®ç»“æž„å†…å­˜æ“ä½œè¿˜æ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œåªæ˜¯æŠŠç¬¬ (1)ã€(3) æ­¥ç½‘ç»œç›¸å…³çš„æ“ä½œå¤šçº¿ç¨‹å¹¶å‘èµ·æ¥äº†ã€‚è¿™æ · pipeline + å¤šçº¿ç¨‹ï¼Œè‚¯å®šå¯ä»¥æå‡ redis çš„ qpsï¼Œå°¤å…¶**å¯¹ç›¸å¯¹è¾ƒé‡çš„ writeï¼Œpipeline å¯ä»¥æ˜Žæ˜¾æå‡ qps**ï¼›é‚£**ä¸ºä»€ä¹ˆ read æå‡ä¸æ˜Žæ˜¾ï¼Œå› ä¸º redis é€šå¸¸æ˜¯å° kvï¼Œç›¸å¯¹è½»é‡çš„ read pipeline å‡ºåŽ»æ”¶ç›Šå°±ä¸å¤§äº†**ï¼Œè€Œä¸”ä¸€æ—¦ pipeline å‡ºåŽ»åšï¼Œè¿˜è¦å¢žåŠ é¢å¤–åœ¨çº¿ç¨‹é—´ä¼ é€’æ˜¯çš„å¼€é”€ï¼ˆä¾‹å¦‚ cache miss ç­‰ï¼‰ï¼›è€Œä¸” Redis çš„ç¬¬ (2) æ­¥åªèƒ½å•çº¿ç¨‹çš„ï¼Œå¦‚æžœå®ƒå¯ä»¥å¤šçº¿ç¨‹çº¿æ€§æ‰©å±•ï¼Œé‚£åˆæ˜¯å¦ä¸€ç•ªæ™¯è±¡äº†ã€‚
> 
> [ä¸ºä»€ä¹ˆ Redis ä½œè€…è¯´å¤šçº¿ç¨‹ IO æ›´å¤§ç¨‹åº¦ä¸Šæ˜¯ä¸ºäº†æå‡å†™çš„æ€§èƒ½ï¼Œè€Œå¯¹è¯»æ²¡ä»€ä¹ˆå¤§å¸®åŠ©ï¼Ÿ](https://www.zhihu.com/question/487432951/answer/2133964039)
> 
> **éœ€è¦æ³¨æ„ï¼š**è¿™ä¸ªé—®é¢˜ redis çš„è¯»ä¸Žå†™æŒ‡çš„æ˜¯ redis server çš„è¯»å–å®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚ä»¥åŠå°†å¤„ç†ç»“æžœå†™å›žç¼“å†²åŒºå‘å›žå®¢æˆ·ç«¯è¿™ä¸¤ä¸ªæ“ä½œï¼Œè€Œä¸æ˜¯ redis å¯¹äºŽæ•°æ®æœ¬èº«çš„ get/set æ“ä½œã€‚

> [http åè®®åœ¨ ip åè®®ä¹‹ä¸Šå¯¹å—ï¼Ÿ](https://www.zhihu.com/question/609936298/answer/3124385394)
> 
> æ˜¾ç„¶åŸºäºŽ Unix Domain socket ä¹Ÿèƒ½è·‘ã€‚