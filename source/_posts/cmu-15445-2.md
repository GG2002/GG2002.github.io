---
title: CMU15445 C++学习笔记-其二（Project 1）
date: 2023-10-12 21:52:09
tags:
---

0.png
大力出奇迹，函数大锁。
1.png
修改了NewPage，在写入Evict的页释放了函数大锁，主要目的是测试bug。
2.png
在FlushPage的时候释放函数大锁加页锁，在DeletePage写入Delete的页时释放了函数大锁，结果更差了。
3.png
  // 分配一个空闲block；
  // buf_pool_mutex_enter；
  // 持有page_hash x lock；
  // 检查page_hash中是否已被读入，如果是，表示另外一个线程已经完成了io，则忽略本次io请求，退出；
  // 持有block->mutex，对block进行初始化，并加入到page hash中；
  // 设置IO FIX为BUF_IO_READ；
  // 释放hash lock；
  // 将block加入到LRU上；
  // 持有block s lock；
  // 完成IO后，释放s lock；